{"version":3,"sources":["../src/index.ts"],"sourcesContent":["type Resolvers<T> = {\n  reject: (error: unknown) => void;\n  resolve: (value: T) => void;\n  promise: Promise<T>;\n};\n\nfunction withResolvers<T>(): Resolvers<T> {\n  const resolvers: Partial<Resolvers<T>> = {};\n\n  resolvers.promise = new Promise((resolve, reject) => {\n    resolvers.reject = reject;\n    resolvers.resolve = resolve;\n  });\n\n  return resolvers as Resolvers<T>;\n}\n\nexport class EventAsPromise<T> {\n  constructor() {\n    this.#eventListener = (event: T) => {\n      const deferred = this.#orderedResolvers.shift();\n\n      deferred && deferred.resolve(event);\n\n      if (this.#upcomingResolvers) {\n        this.#upcomingResolvers.resolve(event);\n        this.#upcomingResolvers = undefined;\n      }\n    };\n  }\n\n  #eventListener: (event: T) => void;\n  #orderedResolvers: Resolvers<T>[] = [];\n  #upcomingResolvers: Resolvers<T> | undefined = undefined;\n\n  get eventListener() {\n    return this.#eventListener;\n  }\n\n  [Symbol.iterator]() {\n    return {\n      next: () => ({\n        done: false,\n        value: this.upcoming()\n      })\n    };\n  }\n\n  one() {\n    const deferred = withResolvers<T>();\n\n    this.#orderedResolvers.push(deferred);\n\n    return deferred.promise;\n  }\n\n  upcoming() {\n    if (!this.#upcomingResolvers) {\n      this.#upcomingResolvers = withResolvers<T>();\n    }\n\n    return this.#upcomingResolvers.promise;\n  }\n}\n"],"mappings":";AAMA,SAAS,gBAAiC;AACxC,QAAM,YAAmC,CAAC;AAE1C,YAAU,UAAU,IAAI,QAAQ,CAAC,SAAS,WAAW;AACnD,cAAU,SAAS;AACnB,cAAU,UAAU;AAAA,EACtB,CAAC;AAED,SAAO;AACT;AAEO,IAAM,iBAAN,MAAwB;AAAA,EAC7B,cAAc;AACZ,SAAK,iBAAiB,CAAC,UAAa;AAClC,YAAM,WAAW,KAAK,kBAAkB,MAAM;AAE9C,kBAAY,SAAS,QAAQ,KAAK;AAElC,UAAI,KAAK,oBAAoB;AAC3B,aAAK,mBAAmB,QAAQ,KAAK;AACrC,aAAK,qBAAqB;AAAA,MAC5B;AAAA,IACF;AAAA,EACF;AAAA,EAEA;AAAA,EACA,oBAAoC,CAAC;AAAA,EACrC,qBAA+C;AAAA,EAE/C,IAAI,gBAAgB;AAClB,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,CAAC,OAAO,QAAQ,IAAI;AAClB,WAAO;AAAA,MACL,MAAM,OAAO;AAAA,QACX,MAAM;AAAA,QACN,OAAO,KAAK,SAAS;AAAA,MACvB;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM;AACJ,UAAM,WAAW,cAAiB;AAElC,SAAK,kBAAkB,KAAK,QAAQ;AAEpC,WAAO,SAAS;AAAA,EAClB;AAAA,EAEA,WAAW;AACT,QAAI,CAAC,KAAK,oBAAoB;AAC5B,WAAK,qBAAqB,cAAiB;AAAA,IAC7C;AAEA,WAAO,KAAK,mBAAmB;AAAA,EACjC;AACF;","names":[]}